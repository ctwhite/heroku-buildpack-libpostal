#!/usr/bin/env bash

set -e

build=${1:-}
cache=${2:-}

mkdir -p "${build}"
mkdir -p "${cache}"

cd "${cache}"

echo "-----> Downloading libpostal"
git clone https://github.com/openvenues/libpostal
cd libpostal/
./bootstrap.sh
LDFLAGS="-L${build}/libpostal/lib" CFLAGS="-I${build}/libpostal/include" PKG_CONFIG_PATH="${build}/libpostal/lib/pkgconfig"
./configure  --enable-fast-install --prefix=/app/libpostal --datadir=/app/libpostal/data

echo "-----> libpostal make"
make
make install

echo "-----> libpostal mv to ${build}/libpostal"
mkdir -p "${build}/libpostal"
mv /app/libpostal/* "${BUILD_DIR}/libpostal"
