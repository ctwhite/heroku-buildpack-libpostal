#!/usr/bin/env bash

set -e

build=${1:-}
cache=${2:-}

mkdir -p "${build}"
mkdir -p "${cache}"

cd "${cache}"

echo "-----> Downloading libpostal"
git clone https://github.com/openvenues/libpostal
cd libpostal/
./bootstrap.sh
LDFLAGS="-L$build/lib" CFLAGS="-I$buildinclude" PKG_CONFIG_PATH="$build/lib/pkgconfig" ./configure --prefix=/app/libpostal --datadir=$build

echo "-----> libpostal make"
make
make install

mv /app/libpostal $build
